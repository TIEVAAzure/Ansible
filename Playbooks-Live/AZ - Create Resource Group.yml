---
# AZ â€“ Create Resource Group
# - Ensures a Resource Group exists (idempotent)
# - Auth: azure.azcollection via AWX Azure credential (no Azure CLI required)

- name: Create Resource Group
  hosts: localhost
  connection: local
  gather_facts: false

  collections:
    - azure.azcollection

  vars:
    # AWX survey variables
    rg_name: ""
    location: ""

  tasks:
    - name: Guard | Validate required inputs
      ansible.builtin.assert:
        that:
          - rg_name | trim | length > 2
          - location | trim | length > 2
        fail_msg: >
          Missing required inputs.
          Ensure rg_name and location are provided via the AWX Survey before running this job.

    - name: Ensure resource group exists
      azure_rm_resourcegroup:
        name: "{{ rg_name }}"
        location: "{{ location }}"
        state: present