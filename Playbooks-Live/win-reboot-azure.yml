---
- name: Reboot Azure VMs via control plane
  hosts: localhost
  connection: local
  gather_facts: no

  # rg_name and azure_vm_names will be overridden by the AWX survey.
  vars:
    rg_name: ""
    azure_vm_names: ""   # Multi-line string from survey, one VM name per line

  tasks:
    - name: Reboot VM via Azure API (no guest access needed)
      azure.azcollection.azure_rm_virtualmachine:
        resource_group: "{{ rg_name }}"
        name: "{{ item }}"
        restarted: yes
      loop: >-
        {{ azure_vm_names.splitlines()
           | map('trim')
           | reject('equalto', '')
           | list }}




