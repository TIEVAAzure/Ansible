# AIB Build Manifest (IMS - AVD Win11 - 2026 Q1)
# Controls:
# - Which Microsoft built-ins run (must/optional)
# - Any parameter values required by those built-ins (dropdowns in the GUI)
# - Which of your custom scripts run from blob (order matters)

manifest_version: 1
customer: "IMS"
image_version: "2026-Q1"
location: "uksouth"

# ----------------------------
# Microsoft built-in customizers
# ----------------------------
microsoft_builtins:
  # Must haves (your standard)
  must:
    set_default_os_language: true
    time_zone_redirection: true
    disable_storage_sense: true
    install_fslogix: true
    configure_rdp_shortpath: true
    install_multimedia_redirection: true
    configure_windows_optimizations: true
    remove_microsoft_office_applications: true

    # IMPORTANT: we run Windows Updates using the AIB WindowsUpdate customizer (not PowerShell)
    apply_windows_updates: true

  # Optional (toggle per customer)
  optional:
    install_languages: false
    enable_kerberos_and_azure_ad: false
    enable_screen_capture_protection: false
    configure_session_timeouts: false

# ----------------------------
# Built-in parameters (GUI dropdown equivalents)
# ----------------------------

# Used by: set_default_os_language (and install_languages if enabled)
os_settings:
  default_os_language: "en-GB"
  install_languages:
    - "en-GB"

# Used by: install_fslogix
fslogix_settings: {}
  # Example: "\\server\share\profiles" (double-backslashes required)
  profile_path: '\\Shared\\Folder\\'
  # VHD/VHDX size in MB
  vhd_size_mb: 30000

# Used by: install_multimedia_redirection
multimedia_settings:
  vc_redist: "x64"              # x64 or x86
  enable_edge: "Yes"            # Yes or No
  enable_chrome: "Yes"          # Yes or No

# Used by: remove_microsoft_office_applications
office_settings:
  type: "Remove"                # Remove (or Add if you ever need it)
  version: "32"                 # 32 or 64
  applications:
    - "Publisher"
    - "PowerPoint"
    - "OneNote"
    - "Excel"
    - "Access"

# Used by: enable_screen_capture_protection (only if optional toggle is true)
screen_capture_settings:
  block_option: "BlockClient"   # BlockClient / BlockBoth (depending on MS script support)

# Used by: configure_session_timeouts (only if optional toggle is true)
# Convention: 0 = never (weâ€™ll handle this in the mapping/playbook)
session_timeouts:
  disconnected_minutes: 30
  idle_minutes: 360
  active_minutes: 0
  signout_minutes: 0

# Used by: configure_windows_optimizations
windows_optimizations:
  optimizations:
    - "WindowsMediaPlayer"
    - "ScheduledTasks"
    - "DefaultUserSettings"
    - "Services"
    - "NetworkOptimizations"
    - "DiskCleanup"
    - "Edge"
    - "RemoveOneDrive"
    - "Autologgers"

# ----------------------------
# Custom scripts (from your blob container)
# Order matters: these run top -> bottom
# blob_path is RELATIVE to the image_version prefix
# Example final URI becomes:
# https://<sa>.blob.core.windows.net/<container>/<image_version>/<blob_path>?<sas>
# ----------------------------
custom_scripts:
  - name: "AVD-AIB-3rdParty-Download"
    blob_path: "Customer/IMS/AVD-AIB-3rdParty-Download.ps1"

  - name: "AVD-AIB-AppInstalls"
    blob_path: "Customer/IMS/AVD-AIB-AppInstalls.ps1"
